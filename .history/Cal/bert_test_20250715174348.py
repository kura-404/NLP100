from bert_score import score
from transformers import AutoModel, AutoTokenizer
import torch

# 使用するBERTモデルの名前 (Hugging Face HubでのモデルID)
model_name = 'tohoku-nlp/bert-base-japanese-v3'


candidates = ["こんにちは，私の今日の朝食は，なったまご飯です．"]
references = ["こんにちは，僕の今日の朝ごはんは，トーストですよ〜．"]
candidates = ["""
本研究は、糖尿病患者の腎症（腎臓の病気）が進行するかどうかを予測する新しい血液中の指標「マイクロRNA-XYZ」の有効性を調べるために、複数の医療機関が協力して行った前向き観察研究です。令和4年度には、全国の糖尿病治療を行う10施設で合計500人の糖尿病患者を登録し、基本情報の収集と血液サンプルの採取を完了しました。マイクロRNA-XYZの測定は専門の検査機関でRT-qPCR法（遺伝子の量を正確に測る技術）を用いて行い、腎臓の機能を示す指標（推定糸球体濾過量：eGFR、尿中のアルブミン排泄量）との関係を分析しました。その結果、マイクロRNA-XYZの血中濃度は腎症の初期段階で有意に高く（p<0.01）、この濃度が腎機能の悪化を予測する独立した因子であることが多変量解析（複数の要因を同時に分析する方法）で明らかになりました（ハザード比2.5、95％信頼区間1.7-3.8）。さらに、追跡調査期間中に腎症が進行した患者では、調査開始時のマイクロRNA-XYZの濃度が有意に高いことも確認されました。これらの結果は、マイクロRNA-XYZが糖尿病性腎症の早期発見および進行予測に役立つバイオマーカー（病気の状態を示す指標）となる可能性を示しています。今後は、本研究のデータを基に、より大規模な検証試験や診断キットの開発に向けた連携を進める予定です。
"""]

references = ["""
本研究は、体液（血液、尿）を使った新しい指標「マイクロRNA[1]-XYZ」が糖尿病患者の腎症[2]が進行するかどうかの予測に有効かを調べるため、複数の医療機関が共同で糖尿病患者の観察を行った研究である。 令和4年度に糖尿病の治療を行う全国10施設で計500例の糖尿病患者を登録し、基本情報の収集と検査に必要な血液の採取を完了した。 マイクロRNA-XYZの測定は所定の検査機関においてRNAの量を正確に測る検査法（RT-qPCR法）を用いて行い、腎臓の機能を測る指標(腎臓が血液をろ過する能力を測る指標、eGFR)、尿中に排泄されるアルブミン量(尿中アルブミン排泄量）と関連があるか分析した。 複数の因子を同時に解析する方法（多変量解析）の結果、マイクロRNA-XYZの血液中の濃度は、初期の腎症において高い傾向にあり、マイクロRNA-XYZの血液中の濃度が他の因子の影響を受けない腎臓の機能の悪化を予測する因子であることが明らかになった。初期の腎症でマイクロRNA-XYZの濃度が高くなる可能性（ハザード比）は2.5倍、95％の患者が１.7-3.8倍の範囲に含まれていた。 さらに、追跡期間中に腎症が進行した患者群では、調査開始時のマイクロRNA-XYZ濃度が高い傾向にあった。 これらの結果は、マイクロRNA-XYZが糖尿病性腎症の早期診断や進行の予測に役立つ指標（バイオマーカー）となる可能性があることを示している。 今後は、今回の研究データをもとに、より大規模な検証試験や異常の有無を簡単にチェックできるキット（診断キット）の開発に向けた連携を進める予定である。
"""]

# モデルを指定する場合には，num_layersを手動で指定する必要あり
P, R, F1 = score(candidates, references, model_type=model_name, num_layers=12, verbose=True)

print(f"Precision: {P.mean().item():.4f}")
print(f"Recall:    {R.mean().item():.4f}")
print(f"F1 Score:  {F1.mean().item():.4f}")
